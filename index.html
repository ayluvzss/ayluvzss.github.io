<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÊïñÈöê - Á¶ªÁ∫øËÅäÂ§© PWA</title>
    <link rel="stylesheet" href="style.css?v=1.0">

    <link rel="manifest" href="manifest.json">
    <link rel="icon" href="assets/icon-192.png" type="image/png">
</head>

<body>
    <!-- ‰∏ªÂÆπÂô® -->
    <div class="app-wrapper">
        <!-- ËÅäÂ§©Â∫îÁî®ÂÆπÂô® -->
        <div class="chat-app">
            <!-- È°∂ÈÉ®Ê†áÈ¢òÊ†è -->
            <header class="chat-header">
                <div class="header-left">
                    <button id="backBtn" class="back-btn">
                        <span class="back-icon">&lt;</span>
                    </button>
                </div>
                <div class="header-center">
                    <h1 class="chat-title">ÊïñÈöê</h1>
                </div>

            </header>

            <!-- ËÆæÁΩÆÈù¢Êùø -->
            <div id="settingsPanel" class="settings-panel">
                <div class="settings-header">
                    <h2>ËÆæÁΩÆ</h2>
                    <button id="closeSettingsBtn" class="close-btn">√ó</button>
                </div>
                <div class="settings-content">


                    <!-- ‰∏ªÈ¢òÊ®°Âºè -->
                    <div class="setting-group">
                        <h3>‰∏ªÈ¢òÊ®°Âºè</h3>
                        <div class="setting-options">
                            <button class="setting-option active" data-theme="pink">Á≤âËâ≤</button>
                            <button class="setting-option" data-theme="cream">Â•∂ÁôΩËâ≤</button>
                            <button class="setting-option" data-theme="purple">Ê∑°Á¥´Ëâ≤</button>
                            <button class="setting-option" data-theme="blue">Ê∑°ËìùËâ≤</button>
                            <button class="setting-option" data-theme="green">Ê∑°ÁªøËâ≤</button>
                            <button class="setting-option" data-theme="dark">Ê∑±Ëâ≤Ê®°Âºè</button>
                            <button class="setting-option" data-theme="white">ÁôΩËâ≤Ê®°Âºè</button>
                            <button class="setting-option" data-theme="black-white">ÈªëÁôΩÊ®°Âºè</button>
                        </div>
                    </div>

                    <!-- ËÉåÊôØËÆæÁΩÆ -->
                    <div class="setting-group">
                        <h3>ËÉåÊôØËÆæÁΩÆ</h3>
                        <div class="setting-options">
                            <label class="setting-option file-label">
                                <input type="file" id="bgFileInput" accept="image/*" style="display: none;">
                                <span>‰∏ä‰º†ËÉåÊôØÂõæ</span>
                            </label>
                            <button class="setting-option" id="resetBgBtn">ÊÅ¢Â§çÈªòËÆ§ËÉåÊôØ</button>
                        </div>
                    </div>

                    <!-- ÂØºÂÖ•ÂØºÂá∫ -->
                    <div class="setting-group">
                        <h3>ËÅäÂ§©ËÆ∞ÂΩï</h3>
                        <div class="setting-options">
                            <label class="setting-option file-label">
                                <input type="file" id="importChatInput" accept=".json" style="display: none;">
                                <span>ÂØºÂÖ•ËÅäÂ§©ËÆ∞ÂΩï</span>
                            </label>
                            <button class="setting-option" id="exportChatBtn">ÂØºÂá∫ËÅäÂ§©ËÆ∞ÂΩï</button>
                        </div>
                    </div>

                    <!-- Â§¥ÂÉèËÆæÁΩÆ -->
                    <div class="setting-group">
                        <h3>Â§¥ÂÉèËÆæÁΩÆ</h3>
                        <div class="setting-options">
                            <div class="avatar-setting">
                                <label class="setting-option file-label">
                                    <input type="file" id="myAvatarInput"
                                        accept="image/png,image/jpeg,image/gif,image/webp,image/*"
                                        style="display: none;">
                                    <span>ÊàëÁöÑÂ§¥ÂÉè</span>
                                </label>
                            </div>
                            <div class="avatar-setting">
                                <label class="setting-option file-label">
                                    <input type="file" id="botAvatarInput"
                                        accept="image/png,image/jpeg,image/gif,image/webp,image/*"
                                        style="display: none;">
                                    <span>ÊïñÈöêÂ§¥ÂÉè</span>
                                </label>
                            </div>
                            <button class="setting-option" id="resetAvatarBtn">ÊÅ¢Â§çÈªòËÆ§Â§¥ÂÉè</button>
                        </div>
                    </div>

                    <!-- ÂõûÂ§çÂ∫ìÁÆ°ÁêÜ -->
                    <div class="setting-group">
                        <h3>ÂõûÂ§çÂ∫ìÁÆ°ÁêÜ</h3>
                        <div class="setting-options">
                            <button class="setting-option" id="manageRepliesBtn">ÂõûÂ§çÂ∫ìËØ¶ÊÉÖ</button>
                        </div>
                    </div>

                    <!-- ÊÅãÁà±Á≥ªÁªüÊï∞ÊçÆ -->
                    <div class="setting-group">
                        <h3>ÊÅãÁà±Á≥ªÁªüÊï∞ÊçÆ</h3>
                        <div class="setting-options">
                            <label class="setting-option file-label">
                                <input type="file" id="importIntimacyInput" accept=".json" style="display: none;">
                                <span>ÂØºÂÖ•ÊÅãÁà±Êï∞ÊçÆ</span>
                            </label>
                            <button class="setting-option" id="exportIntimacyBtn">ÂØºÂá∫ÊÅãÁà±Êï∞ÊçÆ</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Ê∂àÊÅØÂºïÁî®È¢ÑËßà -->
            <div id="quotePreview" class="quote-preview" style="display: none;">
                <div class="quote-content"></div>
                <button id="cancelQuoteBtn" class="cancel-quote-btn">√ó</button>
            </div>

            <!-- ËÅäÂ§©ÂÜÖÂÆπÂå∫Âüü -->
            <div class="chat-content">
                <!-- Êó•ÊúüÂàÜÈöîÁ¨¶ -->
                <div class="date-divider">‰ªäÂ§©</div>

                <!-- Ê∂àÊÅØÂàóË°® -->
                <div id="messages" class="message-list"></div>
            </div>

            <!-- ÈïøÊåâËèúÂçï -->
            <div id="contextMenu" class="context-menu" style="display: none;">
                <button id="quoteMsgBtn" class="context-menu-btn">ÂºïÁî®</button>
            </div>

            <!-- ËæìÂÖ•Âå∫Âüü -->
            <div class="input-area">
                <div class="input-bar">
                    <div class="input-tools">
                        <button id="more-btn" class="tool-btn">‚äπ</button>
                        <button class="tool-btn emoji-btn">‚òª</button>
                        <button id="extraReplyIcon" class="tool-btn">‚ô°</button>
                    </div>
                    
                    <!-- Êõ¥Â§öÂäüËÉΩÂºπÁ™ó -->
                    <div id="moreMenu" class="more-menu" style="display: none;">
                        <button id="dragon-btn" class="tool-btn">üêâ</button>
                        <button id="openDailyNotesBtn" class="tool-btn">üìù</button>
                        <button id="settingsBtn" class="tool-btn">‚ú¶</button>
                    </div>
                    <div class="input-main">
                        <textarea id="messageInput" placeholder="ËæìÂÖ•Ê∂àÊÅØ..." class="message-input"></textarea>
                    </div>
                    <button id="sendBtn" class="send-btn">‚ûº</button>
                </div>

                <!-- Ë°®ÊÉÖÈù¢Êùø -->
                <div class="sticker-panel" style="display: none;">
                    <div class="sticker-list"></div>
                    <div class="sticker-footer">
                        <button class="add-sticker-btn">Ê∑ªÂä†Ë°®ÊÉÖ</button>
                        <input type="file" id="stickerFileInput" accept="image/*" style="display: none;">
                    </div>
                </div>

                <!-- ÊâìÂç°Êó•ÂéÜÊ®°ÊÄÅÊ°Ü -->
                <div class="dragon-calendar-modal" style="display: none;">
                    <div class="calendar-card">
                        <div class="card-header">
                            <div class="checkin-title">ÊâìÂç°</div>
                            <button class="close-calendar">√ó</button>
                        </div>

                        <div class="month-selector">
                                <button class="month-arrow prev">&lt;</button>
                                <span class="current-month">2025Âπ¥ 12Êúà</span>
                                <button class="month-arrow next">&gt;</button>
                            </div>

                        <div class="calendar-grid">
                            <!-- ‰∏ÄÂë®Ê†áÈ¢ò -->
                            <div class="day-title">‰∏Ä</div>
                            <div class="day-title">‰∫å</div>
                            <div class="day-title">‰∏â</div>
                            <div class="day-title">Âõõ</div>
                            <div class="day-title">‰∫î</div>
                            <div class="day-title">ÂÖ≠</div>
                            <div class="day-title">Êó•</div>
                            <!-- Êó•ÊúüÊ†ºÂ≠êÂ∞ÜÈÄöËøáJavaScriptÂä®ÊÄÅÁîüÊàê -->
                        </div>

                        <div class="diary-section">
                            <div class="diary-list" id="diary-list"></div>
                            <div class="diary-input-area">
                                <input type="text" class="diary-input" id="diary-input" placeholder="ËæìÂÖ•‰∫ãÈ°π...">
                                <button class="diary-submit-btn" id="diary-submit-btn">ÊâìÂç°</button>
                            </div>
                        </div>

                        <div class="calendar-footer">
                            Êú¨ÊúàÁ¥ØËÆ°Ôºö<span id="checkin-count">0</span> Â§©
                            <br>
                            ËøûÁª≠ÊâìÂç°Ôºö<span id="streak-count">0</span> Â§©
                        </div>
                    </div>
                </div>

                <!-- ÊØèÊó•ËÆ∞ÂΩïÈù¢Êùø -->
                <div id="dailyNotesPanel" class="popup-panel" style="display:none;">
                    <div class="daily-header"> 
    <button id="dailyPrev">‚ñ≤</button> 
    <span id="dailyDateTitle"></span> 
    <button id="dailyNext">‚ñº</button> 
    <button id="dailyCloseBtn" class="close-btn">‚úï</button> 
</div>
<input id="logDatePicker" class="daily-date-input" style="display:none">

                    <div class="daily-cards-row">
                        <div class="daily-card" id="foodCard">
                            <h3>FOOD</h3>
                            <textarea id="foodInput" placeholder="ËÆ∞ÂΩï‰ªäÂ§©ÂêÉ‰∫Ü‰ªÄ‰πà‚Ä¶"></textarea>
                        </div>

                        <div class="daily-card" id="workoutCard">
                            <h3>WORKOUT</h3>
                            <textarea id="workoutInput" placeholder="ËÆ∞ÂΩïËøêÂä®ÊÉÖÂÜµ‚Ä¶"></textarea>
                        </div>
                    </div>

                    <div class="daily-card" id="letterCard">
                        <h3>To ÊïñÈöê</h3>
                        <textarea id="letterInput" placeholder="ÂÜôÁªôÊïñÈöêÁöÑ‰ø°‚Ä¶"></textarea>
                    </div>

                    <div class="daily-card" id="footerNoteCard">
                        <h3>ÊïñÈöêÈôÑË®Ä</h3>
                        <div id="dailyFooterNote" class="daily-footer-note"></div>
                    </div>

                    <div class="daily-footer">
                        <button id="dailySaveBtn">‰øùÂ≠ò</button>
                        <button id="dailyExportBtn">ÂØºÂá∫ÂΩìÂ§©</button>
                    </div>
                </div>
                <!-- ‰∫≤ÂØÜÂ∫¶ËØ¶ÊÉÖÂºπÁ™ó (Êñ∞Áâà) -->
                <div id="intimacyModal" class="intimacy-modal-overlay" style="display: none;">
                    <div class="intimacy-modal-card">
                        <!-- È°∂ÈÉ®ÂõæÁâáÂå∫Âüü (16:9 Ê®™ÂπÖ) -->
                        <div class="intimacy-header-banner" id="intimacyBanner">
                            <span class="default-symbol">‚Çä‚Å∫ Íí∞‡ßß ‚ô° ‡ªíÍí± ‚Å∫‚Çä</span>
                        </div>
                        <input type="file" id="bannerUpload_New" accept="image/*" style="display: none;">

                        <!-- ÊÅãÁà±Â§©Êï∞ -->
                        <div class="love-days-container">
                            <div class="love-text">
                                <div class="love-line">
                                    <span class="love-full">
                                        Â∑≤Êàê‰∏∫ÊÅã‰∫∫ ‚Çä‚Å∫ Íí∞‡ßß ‚ô° ‡ªíÍí± ‚Å∫‚Çä
                                        <span id="loveDays" class="highlight-anim">584</span> Â§©
                                    </span>
                                </div>
                                <div class="love-line">
                                    <span class="love-full">
                                        2024Âπ¥5Êúà2Êó•Áõ∏Áà±
                                    </span>
                                </div>
                            </div>
                        </div>

                        <!-- Á≠âÁ∫ßÂå∫Âùó -->
                        <div class="level-row">
                            <div class="level-line">
                                <span class="level-full">
                                    Êò•‰∏≠Èõ™ üíó LV <span id="modalLevel" class="highlight-anim">9</span>
                                </span>
                            </div>
                        </div>

                        <!-- Êï∞ÂÄº‰ø°ÊÅØ (GridÂ∏ÉÂ±Ä) -->
                        <div class="stats-grid">
                            <div class="stat-label">ÂΩìÂâç‰∫≤ÂØÜÂ∫¶Ôºö</div>
                            <div class="stat-value"><span id="modalCurrentPoints" class="highlight-anim">0</span> ü©∑
                            </div>

                            <div class="stat-label">Ë∑ùÁ¶ª‰∏ã‰∏ÄÁ≠âÁ∫ßÔºö</div>
                            <div class="stat-value"><span id="modalNextLevelDiff" class="highlight-anim">0</span> ÁÇπ
                            </div>

                            <div class="stat-label">‰ªäÊó•ËÅäÂ§©Ôºö</div>
                            <div class="stat-value"><span id="modalTodayCount" class="highlight-anim">0</span> Êù°</div>

                            <div class="stat-label">ÊÄªËÅäÂ§©ÈáèÔºö</div>
                            <div class="stat-value"><span id="modalTotalCount" class="highlight-anim">0</span> Êù°</div>
                        </div>

                        <!-- ÂÖ≥Èó≠ÊåâÈíÆ -->
                        <button id="closeIntimacyModalBtn" class="modal-close-btn-new">ÂÖ≥Èó≠</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ÂõûÂ§çÂ∫ìÁÆ°ÁêÜÂºπÁ™ó -->
    <div id="replyLibraryModal" class="intimacy-modal-overlay" style="display: none;">
        <div class="intimacy-modal-card">

            <div class="modal-header">
                <span class="modal-title">ÂõûÂ§çÂ∫ìÁÆ°ÁêÜ</span>
                <button id="closeReplyModalBtn" class="close-btn">√ó</button>
            </div>

            <div class="search-row">
                <input id="replySearchInput" type="text" placeholder="ÊêúÁ¥¢ÂÖ≥ÈîÆËØç‚Ä¶" />
                <label class="icon-btn">
                    <input type="file" id="importRepliesInModal" accept=".json" hidden>
                    üì•
                </label>
                <button id="exportRepliesBtn" class="icon-btn">üì§</button>
            </div>

            <div id="replyList" class="reply-list"></div>

            <button id="addReplyBtn" class="add-reply-btn">Ôºã Êñ∞Â¢ûÂõûÂ§ç</button>

        </div>
    </div>

    <script src="app.js?v=1.0"></script>
    <script>
        // ‰∏¥Êó∂Á¶ÅÁî® Service Worker
        /*
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('service-worker.js')
                    .then(registration => {
                        console.log('ServiceWorker registration successful with scope: ', registration.scope);
                    })
                    .catch(error => {
                        console.log('ServiceWorker registration failed: ', error);
                    });
            });
        }
        */
    </script>
    <!-- Áªü‰∏ÄÁöÑ CalendarModal Êó•ÊúüÂºπÁ™óÁªÑ‰ª∂ -->
    <div id="calendarModal" class="calendar-modal" style="display: none;">
        <div class="calendar-modal-overlay"></div>
        <div class="calendar-modal-content">
            <div class="calendar-header">
                <h3 class="calendar-title">ÈÄâÊã©Êó•Êúü</h3>
                <button class="calendar-close-btn">√ó</button>
            </div>
            <div class="calendar-body">
                <div class="calendar-nav">
                    <button class="calendar-nav-btn prev-month">‚Äπ</button>
                    <span class="current-date-display"></span>
                    <button class="calendar-nav-btn next-month">‚Ä∫</button>
                </div>
                <div class="calendar-grid-container">
                    <div class="calendar-weekdays">
                        <div class="weekday">Êó•</div>
                        <div class="weekday">‰∏Ä</div>
                        <div class="weekday">‰∫å</div>
                        <div class="weekday">‰∏â</div>
                        <div class="weekday">Âõõ</div>
                        <div class="weekday">‰∫î</div>
                        <div class="weekday">ÂÖ≠</div>
                    </div>
                    <div class="calendar-days"></div>
                </div>
            </div>
        </div>
    </div>
</body>
 
</html>